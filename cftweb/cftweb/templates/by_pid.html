{% extends "base.jinja" %}
{% block page_css %}
<style>
 tr.clickable-row { cursor: pointer; } 
</style>
<script>
jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.location = $(this).data("href");
    });
  });
</script>
{% endblock %}

{% block content %}
<h2>Clusters Grouped by Patient</h2>
<div class="row">
  <div class="col-md-6">
    <table class="table  table-striped table-hover">
      <thead>
	<tr>
	<th>Patient ID</th>
	<th>timepoints</th>
	<th>seeds</th>
	<th>clusters</th>
	</tr>
      </thead>
      <tbody>
	
	{% for group in clusters|groupby('pid') %}
	{% set tplist = group.list| map(attribute='timepoint')| list| unique -%}
	{% set ntp = tplist | length -%}
	{% set slist = group.list| map(attribute='seedid')| list| unique -%}
	{% set ns = slist | length -%}
	{% set nc = group.list | length -%}

	<tr class='clickable-row' data-href='{{ url_for('by_timepoint', pid=group.grouper) }}'>
	  <td>{{ group.grouper }}</td>
	  <td>{{ ntp }} timepoint{{ "s" if ntp > 1 else ""}}</td>
	  <td>{{ ns }} seed{{ "s" if ns > 1 else ""}}</td>
	  <td>{{ nc }} cluster{{ "s" if nc > 1 else ""}}</td>
	</tr>
	{%-endfor-%}
      </tbody>
    </table>
    
  </div>
</div>
{% endblock %}

